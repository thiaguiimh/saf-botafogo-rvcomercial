<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Remuneração Variável - SAF Botafogo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Calm Harmony (Slate Gray, White, Accent Blue) -->
    <!-- Application Structure Plan: A dashboard-style SPA guiding the user through the remuneration model. It starts with an overview, moves to a central interactive calculator/simulator with a new collapsible configuration panel, and finishes with a comparative analysis. This task-oriented flow makes the complex proposal tangible and easy to grasp. -->
    <!-- Visualization & Content Choices: Revenue Input -> Goal: Explore -> Slider -> User can see immediate impact on total bonus pool. Team Builder -> Goal: Simulate -> Dynamic Table + Selects. Configuration Panel -> Goal: Customize -> Input fields for real-time model adjustments. Bonus Results -> Goal: Compare -> Bar Chart (Chart.js). Comparison Table -> Goal: Justify -> Styled HTML Table. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f9fafb; color: #334155; }
        .chart-container { position: relative; width: 100%; max-width: 800px; margin-left: auto; margin-right: auto; height: 350px; max-height: 40vh; }
        @media (min-width: 768px) { .chart-container { height: 400px; } }
        .config-section {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out;
        }
        .card {
            background-color: white;
            border-radius: 1.5rem; /* 24px */
            padding: 2rem; /* 32px */
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.05), 0 4px 6px -4px rgb(0 0 0 / 0.05);
            border: 1px solid #e2e8f0;
        }
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
          -webkit-appearance: none; 
          margin: 0; 
        }
        input[type=number] {
          -moz-appearance: textfield;
        }
    </style>
</head>
<body class="antialiased">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">
        
        <header class="text-center mb-16">
            <h1 class="text-4xl md:text-5xl font-bold text-slate-900 tracking-tight">Simulador da Nova Política de Remuneração Variável</h1>
            <p class="mt-4 text-lg text-slate-500">Explore de forma interativa como o modelo "Pool de Performance" da SAF Botafogo funciona.</p>
        </header>

        <main class="space-y-16">

            <section id="philosophy" class="card">
                <h2 class="text-3xl font-bold text-slate-900 mb-2 text-center tracking-tight">A Filosofia: O Modelo "Pool de Performance"</h2>
                <p class="text-center text-slate-500 mb-8 max-w-4xl mx-auto">Este modelo abandona uma distribuição fixa por um sistema mais justo e dinâmico, baseado em uma sequência clara de 5 passos.</p>
                <div class="grid grid-cols-1 md:grid-cols-5 gap-6 text-center">
                    <div class="bg-slate-50 p-4 rounded-xl flex flex-col">
                        <div class="text-blue-600 text-3xl mb-2 font-bold">①</div>
                        <h3 class="font-semibold text-slate-800 mb-1">Cálculo do Pool Base</h3>
                        <p class="text-sm text-slate-500">A receita comercial da SAF define o valor inicial do "bolo" de bônus.</p>
                    </div>
                    <div class="bg-slate-50 p-4 rounded-xl flex flex-col">
                        <div class="text-blue-600 text-3xl mb-2 font-bold">②</div>
                        <h3 class="font-semibold text-slate-800 mb-1">Atribuição de Pontos</h3>
                        <p class="text-sm text-slate-500">Cada colaborador recebe pontos com base no cargo e na sua avaliação de desempenho.</p>
                    </div>
                    <div class="bg-slate-50 p-4 rounded-xl flex flex-col">
                        <div class="text-blue-600 text-3xl mb-2 font-bold">③</div>
                        <h3 class="font-semibold text-slate-800 mb-1">Valor por Ponto (Base)</h3>
                        <p class="text-sm text-slate-500">O Pool Base é dividido pela soma dos pontos, resultando num valor de ponto preliminar.</p>
                    </div>
                    <div class="bg-slate-50 p-4 rounded-xl flex flex-col">
                        <div class="text-blue-600 text-3xl mb-2 font-bold">④</div>
                        <h3 class="font-semibold text-slate-800 mb-1">Ajuste por Metas</h3>
                        <p class="text-sm text-slate-500">O atingimento das metas do departamento gera um multiplicador que ajusta o valor do ponto.</p>
                    </div>
                    <div class="bg-green-50/50 border border-green-200 p-4 rounded-xl flex flex-col">
                        <div class="text-green-600 text-3xl mb-2 font-bold">⑤</div>
                        <h3 class="font-semibold text-slate-800 mb-1">Bônus Individual</h3>
                        <p class="text-sm text-slate-500">Os pontos de cada um são multiplicados pelo valor final do ponto, resultando na recompensa.</p>
                    </div>
                </div>
            </section>

             <section id="configurator" class="bg-slate-100/70 p-6 rounded-2xl">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-slate-900 tracking-tight">Configurações do Modelo</h2>
                    <button id="configToggleBtn" class="flex items-center gap-2 text-sm font-semibold text-blue-600 hover:text-blue-800 transition-colors py-1 px-3 rounded-lg hover:bg-blue-100">
                        <span id="configToggleText">Ajustar</span>
                        <span id="configToggleIcon" class="transform transition-transform">▼</span>
                    </button>
                </div>
                <div id="configContent" class="config-section mt-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                        <div>
                            <h3 class="font-semibold text-slate-700 mb-2">Pontos Base por Cargo</h3>
                            <div id="configCargos" class="space-y-2"></div>
                        </div>
                         <div>
                            <h3 class="font-semibold text-slate-700 mb-2">Multiplicador de Performance</h3>
                            <div id="configPerformances" class="space-y-2"></div>
                        </div>
                        <div>
                            <h3 class="font-semibold text-slate-700 mb-2">Faixas para Cálculo do Pool</h3>
                            <div id="configFaixas" class="space-y-3"></div>
                        </div>
                        <div>
                            <h3 class="font-semibold text-slate-700 mb-2">Multiplicador por Meta de Departamento</h3>
                            <div id="configDepartamento" class="space-y-3"></div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="calculator" class="card">
                <h2 class="text-3xl font-bold text-slate-900 mb-8 text-center tracking-tight">Calculadora Interativa</h2>
                
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                    <div class="lg:col-span-5 space-y-6">
                        <div class="p-6 border rounded-xl bg-slate-50">
                            <label for="revenueSlider" class="block font-semibold text-slate-700 text-center">Passo 1: Receita Comercial Bruta Anual</label>
                            <input type="range" id="revenueSlider" min="10000000" max="200000000" step="1000000" value="50000000" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer mt-4">
                            <div class="text-center mt-2">
                                <span class="text-3xl font-bold text-blue-700" id="revenueValue">R$ 50.000.000</span>
                            </div>
                        </div>
                        
                        <div class="p-6 border rounded-xl bg-slate-50">
                            <label for="departmentGoalSlider" class="block font-semibold text-slate-700 text-center">Passo 2: Atingimento da Meta do Departamento</label>
                            <input type="range" id="departmentGoalSlider" min="80" max="150" step="1" value="120" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer mt-4">
                            <div class="text-center mt-2">
                                <span class="text-3xl font-bold text-blue-700" id="departmentGoalValue">120%</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="lg:col-span-7">
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="font-semibold text-slate-700">Passo 3: Monte a sua Equipe</h3>
                                <button id="addEmployeeBtn" class="bg-blue-600 text-white px-4 py-2 text-sm rounded-lg hover:bg-blue-700 transition-colors">
                                    + Adicionar Colaborador
                                </button>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full table-fixed bg-white border rounded-lg">
                                    <thead class="bg-slate-100 text-slate-600 text-xs uppercase">
                                        <tr>
                                            <th class="p-2 text-left">Nome</th>
                                            <th class="p-2 text-left w-36">Cargo</th>
                                            <th class="p-2 text-left w-48">Avaliação</th>
                                            <th class="p-2 text-right w-24">Pontos Finais</th>
                                            <th class="p-2 text-center w-16">Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody id="teamTableBody">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-8">
                    <div class="max-w-xl mx-auto p-6 border rounded-xl bg-slate-50">
                         <h3 class="font-semibold text-slate-700 mb-4 text-center">Resultados do Pool</h3>
                         <div class="space-y-3 text-sm">
                             <div class="flex justify-between"><span>Pool Base (via Receita):</span> <strong id="poolBaseValue" class="font-medium">R$ 650.000,00</strong></div>
                             <div class="flex justify-between"><span>Multiplicador (Metas Depto.):</span> <strong id="departmentMultiplierValue" class="font-medium">1.20x</strong></div>
                             <div class="flex justify-between items-center border-t border-slate-200 pt-3 mt-2">
                                <span class="font-bold text-base">Pool Final Ajustado:</span>
                                <strong id="poolFinalValue" class="text-xl text-green-600 font-bold">R$ 780.000,00</strong>
                             </div>
                             <hr class="border-slate-200">
                             <div class="flex justify-between"><span>Total de Pontos da Equipe:</span> <strong id="totalPointsValue" class="font-medium">968,8</strong></div>
                             <div class="flex justify-between"><span>Valor por Ponto:</span> <strong id="pointValue" class="font-medium text-blue-600">R$ 805,17</strong></div>
                         </div>
                    </div>
                </div>

                <div class="mt-10">
                    <h3 class="text-xl font-bold text-slate-900 mb-4 text-center tracking-tight">Passo 4: Distribuição Final do Bônus</h3>
                    <div class="chart-container">
                        <canvas id="bonusChart"></canvas>
                    </div>
                </div>
            </section>

             <section id="regras" class="card">
                <h2 class="text-3xl font-bold text-slate-900 mb-8 text-center tracking-tight">As Regras do Jogo</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="bg-slate-50 p-6 rounded-xl border-l-4 border-green-500">
                        <h3 class="text-xl font-bold text-green-700 mb-4">O Que CONTA para o Bônus?</h3>
                        <ul class="list-disc list-inside space-y-3 text-slate-600">
                            <li>Contratos de comercialização B2B.</li>
                            <li>Patrocínios em uniformes e redes sociais.</li>
                            <li>Venda de camarotes e placas de publicidade.</li>
                            <li class="p-3 bg-blue-50/50 rounded-lg border border-blue-200 text-sm"><span class="font-semibold text-blue-800">Critério de Apuração:</span> A receita é apurada em **regime de caixa**. Apenas valores efetivamente recebidos no período são considerados.</li>
                        </ul>
                    </div>
                    <div class="bg-slate-50 p-6 rounded-xl border-l-4 border-red-500">
                        <h3 class="text-xl font-bold text-red-700 mb-4">O Que NÃO CONTA para o Bônus?</h3>
                        <ul class="list-disc list-inside space-y-3 text-slate-600">
                            <li>Acordos de direito de transmissão.</li>
                            <li>Royalties de licenciamento.</li>
                            <li>Receitas de Matchday (B2C).</li>
                            <li>Patrocínio de material esportivo.</li>
                            <li>Contratos celebrados diretamente pela holding (Eagle Football).</li>
                        </ul>
                    </div>
                </div>
            </section>

            <section id="comparison" class="card">
                <h2 class="text-3xl font-bold text-slate-900 mb-8 text-center tracking-tight">Análise Comparativa: Por que este modelo é melhor?</h2>
                <div class="overflow-x-auto">
                    <table class="min-w-full border-collapse">
                        <thead>
                            <tr class="bg-slate-100">
                                <th class="border border-slate-200 p-3 text-left text-slate-700 text-sm font-semibold">Critério</th>
                                <th class="border border-slate-200 p-3 text-left text-slate-700 text-sm font-semibold">Modelo Antigo (BFR 2023)</th>
                                <th class="border border-slate-200 p-3 text-left text-blue-800 bg-blue-50 text-sm font-semibold">Novo Modelo (Pool de Performance)</th>
                                <th class="border border-slate-200 p-3 text-left text-slate-700 text-sm font-semibold">Vantagem Estratégica</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="hover:bg-slate-50/50">
                                <td class="border border-slate-200 p-3 font-semibold text-slate-800">Meritocracia</td>
                                <td class="border border-slate-200 p-3 text-slate-600">Inexistente. Pagamento igual por cargo.</td>
                                <td class="border border-slate-200 p-3 text-slate-800 font-medium">Central. A avaliação do gestor é um multiplicador direto da recompensa.</td>
                                <td class="border border-slate-200 p-3 text-slate-600">Estimula a superação e reconhece de forma justa os colaboradores de alto desempenho.</td>
                            </tr>
                            <tr class="hover:bg-slate-50/50">
                                <td class="border border-slate-200 p-3 font-semibold text-slate-800">Justiça Percebida</td>
                                <td class="border border-slate-200 p-3 text-slate-600">Baixa. Distribuição fixa e muito concentrada no topo.</td>
                                <td class="border border-slate-200 p-3 text-slate-800 font-medium">Alta. A distribuição é flexível e baseada no desempenho relativo de toda a equipe.</td>
                                <td class="border border-slate-200 p-3 text-slate-600">Melhora o Clima Organizacional e aumenta o engajamento.</td>
                            </tr>
                            <tr class="hover:bg-slate-50/50">
                                <td class="border border-slate-200 p-3 font-semibold text-slate-800">Simplicidade</td>
                                <td class="border border-slate-200 p-3 text-slate-600">Complexo, com regras de exceção e ajustes subjetivos.</td>
                                <td class="border border-slate-200 p-3 text-slate-800 font-medium">Simples e Transparente. A lógica de pontos é fácil de comunicar.</td>
                                <td class="border border-slate-200 p-3 text-slate-600">A equipe foca em performar, não em decifrar regras ou negociar exceções.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
            
            <footer class="text-center text-slate-500 text-sm pt-6">
                <p>Esta é uma ferramenta de simulação baseada na "Proposta de Nova Política de Remuneração Variável Comercial".</p>
                <p>Todos os valores são ilustrativos.</p>
            </footer>
        </main>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    let state = {
        revenue: 50000000,
        departmentGoal: 120,
        team: [
            { id: 1, nome: 'Pessoa I', cargo: 'Diretor', performance: 'Excepcional' },
            { id: 2, nome: 'Pessoa II', cargo: 'Gerente', performance: 'Acima do esperado' },
            { id: 3, nome: 'Pessoa III', cargo: 'Analista Comercial', performance: 'Excepcional' },
            { id: 4, nome: 'Pessoa IV', cargo: 'Analista Comercial', performance: 'Atende às expectativas' },
        ],
        nextId: 5,
        config: {
            pontosPorCargo: {
                'Analista Comercial': 75,
                'Coordenador/Especialista': 100,
                'Gerente': 175,
                'Diretor': 350,
            },
            multiplicadorPorPerformance: {
                'Abaixo do esperado': 0.75,
                'Atende às expectativas': 1.0,
                'Acima do esperado': 1.25,
                'Excepcional': 1.5,
            },
            faixasBonificacao: [
                { ate: 40000000, perc: 0.0025 },
                { ate: 80000000, perc: 0.0050 },
                { acima: 80000000, perc: 0.01 },
            ],
            multiplicadorDepartamento: [
                { atingimento: 80, multiplicador: 0.8 },
                { atingimento: 100, multiplicador: 1.0 },
                { atingimento: 150, multiplicador: 1.5 },
            ]
        }
    };

    const revenueSlider = document.getElementById('revenueSlider');
    const revenueValue = document.getElementById('revenueValue');
    const departmentGoalSlider = document.getElementById('departmentGoalSlider');
    const departmentGoalValue = document.getElementById('departmentGoalValue');

    const poolBaseValue = document.getElementById('poolBaseValue');
    const departmentMultiplierValue = document.getElementById('departmentMultiplierValue');
    const poolFinalValue = document.getElementById('poolFinalValue');
    
    const totalPointsValue = document.getElementById('totalPointsValue');
    const pointValue = document.getElementById('pointValue');
    const teamTableBody = document.getElementById('teamTableBody');
    const addEmployeeBtn = document.getElementById('addEmployeeBtn');
    const chartCanvas = document.getElementById('bonusChart');
    let bonusChart = null;

    const configToggleBtn = document.getElementById('configToggleBtn');
    const configContent = document.getElementById('configContent');
    const configToggleIcon = document.getElementById('configToggleIcon');
    const configToggleText = document.getElementById('configToggleText');
    const configCargosContainer = document.getElementById('configCargos');
    const configPerformancesContainer = document.getElementById('configPerformances');
    const configFaixasContainer = document.getElementById('configFaixas');
    const configDepartamentoContainer = document.getElementById('configDepartamento');

    const formatCurrency = (value, showSymbol = true) => {
        if (isNaN(value)) return showSymbol ? 'R$ 0,00' : '0,00';
        const options = showSymbol ? { style: 'currency', currency: 'BRL' } : { style: 'decimal', minimumFractionDigits: 2, maximumFractionDigits: 2 };
        return new Intl.NumberFormat('pt-BR', options).format(value);
    };

    const parseCurrency = (value) => {
        return Number(String(value).replace(/\./g, '').replace(',', '.'));
    };
    
    const formatPercent = (value, multiplier = 100) => {
        return (value * multiplier).toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    };

    const parsePercent = (value, multiplier = 100) => {
        return parseCurrency(value) / multiplier;
    };

    function calculateBasePool(revenue) {
        const faixas = state.config.faixasBonificacao;
        let pool = 0;
        
        if (revenue <= faixas[0].ate) {
            pool = revenue * faixas[0].perc;
        } else if (revenue <= faixas[1].ate) {
            pool = faixas[0].ate * faixas[0].perc;
            pool += (revenue - faixas[0].ate) * faixas[1].perc;
        } else {
            pool = faixas[0].ate * faixas[0].perc;
            pool += (faixas[1].ate - faixas[0].ate) * faixas[1].perc;
            pool += (revenue - faixas[1].ate) * faixas[2].perc;
        }
        return pool;
    }
    
    function calculateDepartmentMultiplier(atingimento) {
        const config = state.config.multiplicadorDepartamento;
        const x_coords = config.map(p => p.atingimento);
        const y_coords = config.map(p => p.multiplicador);

        if (atingimento <= x_coords[0]) return y_coords[0];
        if (atingimento >= x_coords[x_coords.length - 1]) return y_coords[y_coords.length - 1];

        let i = 1;
        while (atingimento > x_coords[i]) i++;

        const x1 = x_coords[i-1], y1 = y_coords[i-1];
        const x2 = x_coords[i], y2 = y_coords[i];
        
        return y1 + (y2 - y1) * (atingimento - x1) / (x2 - x1);
    }

    function renderConfig() {
        configCargosContainer.innerHTML = '';
        Object.entries(state.config.pontosPorCargo).forEach(([cargo, pontos]) => {
            configCargosContainer.innerHTML += `<div class="flex items-center justify-between text-sm"><label class="text-slate-600">${cargo}</label><input type="number" value="${pontos}" data-type="cargo" data-key="${cargo}" class="w-20 p-1 border rounded text-right"></div>`;
        });

        configPerformancesContainer.innerHTML = '';
        Object.entries(state.config.multiplicadorPorPerformance).forEach(([perf, mult]) => {
            configPerformancesContainer.innerHTML += `<div class="flex items-center justify-between text-sm"><label class="text-slate-600">${perf}</label><input type="number" step="0.05" value="${mult}" data-type="performance" data-key="${perf}" class="w-20 p-1 border rounded text-right"></div>`;
        });
        
        configFaixasContainer.innerHTML = '';
        state.config.faixasBonificacao.forEach((faixa, index) => {
             if (faixa.ate) {
                configFaixasContainer.innerHTML += `<div class="p-2 border rounded-md bg-white"><label class="block text-xs text-slate-500">Faixa ${index + 1}: Até</label><input type="text" value="${formatCurrency(faixa.ate, false)}" data-type="faixa-ate" data-index="${index}" class="w-full p-1 border rounded text-right mb-1"><label class="block text-xs text-slate-500">Percentual</label><div class="relative"><input type="text" value="${formatPercent(faixa.perc)}" data-type="faixa-perc" data-index="${index}" class="w-full p-1 border rounded text-right pr-6"><span class="absolute right-2 top-1/2 -translate-y-1/2 text-slate-500">%</span></div></div>`;
             } else {
                 configFaixasContainer.innerHTML += `<div class="p-2 border rounded-md bg-white"><label class="block text-xs text-slate-500">Faixa ${index + 1}: Acima de ${formatCurrency(state.config.faixasBonificacao[index-1].ate)}</label><label class="block text-xs text-slate-500 mt-8">Percentual</label><div class="relative"><input type="text" value="${formatPercent(faixa.perc)}" data-type="faixa-perc" data-index="${index}" class="w-full p-1 border rounded text-right pr-6"><span class="absolute right-2 top-1/2 -translate-y-1/2 text-slate-500">%</span></div></div>`;
             }
        });

        configDepartamentoContainer.innerHTML = '';
        state.config.multiplicadorDepartamento.forEach((item, index) => {
            const labels = ['Mínimo', 'Alvo', 'Máximo'];
            configDepartamentoContainer.innerHTML += `<div class="p-2 border rounded-md bg-white"><label class="block text-xs text-slate-500">Atingimento ${labels[index]}</label><div class="relative"><input type="text" value="${item.atingimento}" data-type="depto-atingimento" data-index="${index}" class="w-full p-1 border rounded text-right pr-6"><span class="absolute right-2 top-1/2 -translate-y-1/2 text-slate-500">%</span></div><label class="block text-xs text-slate-500 mt-1">Multiplicador</label><input type="number" step="0.01" value="${item.multiplicador}" data-type="depto-multiplicador" data-index="${index}" class="w-full p-1 border rounded text-right"></div>`;
        });
    }

    function renderTeam() {
        teamTableBody.innerHTML = '';
        if (state.team.length === 0) {
            const row = document.createElement('tr');
            row.innerHTML = `<td colspan="5" class="p-4 text-center text-slate-500">Adicione um colaborador para começar a simulação.</td>`;
            teamTableBody.appendChild(row);
            return;
        }

        state.team.forEach(employee => {
            const row = document.createElement('tr');
            row.id = `employee-${employee.id}`;
            row.className = 'border-b border-slate-100 text-sm';

            const pontosBase = state.config.pontosPorCargo[employee.cargo] || 0;
            const multiplicador = state.config.multiplicadorPorPerformance[employee.performance] || 0;
            const pontosFinais = pontosBase * multiplicador;

            const cargoOptions = Object.keys(state.config.pontosPorCargo).map(cargo => 
                `<option value="${cargo}" ${employee.cargo === cargo ? 'selected' : ''}>${cargo}</option>`
            ).join('');

            const performanceOptions = Object.keys(state.config.multiplicadorPorPerformance).map(perf => 
                `<option value="${perf}" ${employee.performance === perf ? 'selected' : ''}>${perf}</option>`
            ).join('');
            
            row.innerHTML = `
                <td class="p-2"><input type="text" value="${employee.nome}" class="w-full p-2 border rounded bg-white text-sm" data-id="${employee.id}" data-field="nome"></td>
                <td class="p-2"><select class="w-full p-2 border rounded bg-white text-sm" data-id="${employee.id}" data-field="cargo">${cargoOptions}</select></td>
                <td class="p-2"><select class="w-full p-2 border rounded bg-white text-sm" data-id="${employee.id}" data-field="performance">${performanceOptions}</select></td>
                <td class="p-2 text-right font-medium text-slate-700">${pontosFinais.toFixed(1)}</td>
                <td class="p-2 text-center"><button class="text-red-500 hover:text-red-700 transition-colors" data-id="${employee.id}" data-action="delete">✖</button></td>
            `;
            teamTableBody.appendChild(row);
        });
    }

    function renderChart(teamData) {
        if (bonusChart) {
            bonusChart.destroy();
        }

        const ctx = chartCanvas.getContext('2d');
        const chartLabels = teamData.map(e => [e.nome, `(${e.cargo})`]);

        bonusChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: chartLabels,
                datasets: [{
                    label: 'Bônus Bruto a Receber',
                    data: teamData.map(e => e.bonusFinal.toFixed(2)),
                    backgroundColor: 'rgba(59, 130, 246, 0.7)',
                    borderColor: 'rgba(59, 130, 246, 1)',
                    borderWidth: 1,
                    borderRadius: 4,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: { beginAtZero: true, ticks: { callback: function(value) { return formatCurrency(value); } } }
                },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            title: function(tooltipItems) {
                                const item = tooltipItems[0];
                                let label = item.chart.data.labels[item.dataIndex];
                                if (Array.isArray(label)) { return label.join(' '); }
                                return label;
                            },
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) { label += ': '; }
                                if (context.parsed.y !== null) { label += formatCurrency(context.parsed.y); }
                                return label;
                            }
                        }
                    }
                }
            }
        });
    }

    function updateSimulation() {
        const basePool = calculateBasePool(state.revenue);
        const departmentMultiplier = calculateDepartmentMultiplier(state.departmentGoal);
        const finalPool = basePool * departmentMultiplier;
        
        let totalPontos = 0;
        const teamDataWithPoints = state.team.map(employee => {
            const pontosBase = state.config.pontosPorCargo[employee.cargo] || 0;
            const multiplicador = state.config.multiplicadorPorPerformance[employee.performance] || 0;
            const pontosFinais = pontosBase * multiplicador;
            totalPontos += pontosFinais;
            return { ...employee, pontosFinais };
        });

        const valorDoPonto = totalPontos > 0 ? finalPool / totalPontos : 0;
        
        const finalTeamData = teamDataWithPoints.map(employee => ({
            ...employee,
            bonusFinal: employee.pontosFinais * valorDoPonto
        }));
        
        poolBaseValue.textContent = formatCurrency(basePool);
        departmentMultiplierValue.textContent = `${departmentMultiplier.toFixed(2)}x`;
        poolFinalValue.textContent = formatCurrency(finalPool);

        totalPointsValue.textContent = totalPontos.toFixed(1);
        pointValue.textContent = formatCurrency(valorDoPonto);

        renderTeam();
        renderChart(finalTeamData);
    }

    revenueSlider.addEventListener('input', (e) => {
        state.revenue = Number(e.target.value);
        revenueValue.textContent = formatCurrency(state.revenue);
        updateSimulation();
    });
    
    departmentGoalSlider.addEventListener('input', (e) => {
        state.departmentGoal = Number(e.target.value);
        departmentGoalValue.textContent = `${state.departmentGoal}%`;
        updateSimulation();
    });

    addEmployeeBtn.addEventListener('click', () => {
        const newEmployee = {
            id: state.nextId++,
            nome: `Colaborador ${state.nextId - 1}`,
            cargo: 'Analista Comercial',
            performance: 'Atende às expectativas',
        };
        state.team.push(newEmployee);
        updateSimulation();
    });

    teamTableBody.addEventListener('change', (e) => {
        if (e.target.matches('select, input')) {
            const id = Number(e.target.dataset.id);
            const field = e.target.dataset.field;
            const employee = state.team.find(emp => emp.id === id);
            if (employee) {
                employee[field] = e.target.value;
                updateSimulation();
            }
        }
    });
    
    teamTableBody.addEventListener('click', (e) => {
        if (e.target.matches('button[data-action="delete"]')) {
            const id = Number(e.target.dataset.id);
            state.team = state.team.filter(emp => emp.id !== id);
            updateSimulation();
        }
    });

    configToggleBtn.addEventListener('click', () => {
        if (configContent.style.maxHeight) {
            configContent.style.maxHeight = null;
            configToggleIcon.style.transform = 'rotate(0deg)';
            configToggleText.textContent = 'Ajustar';
        } else {
            configContent.style.maxHeight = configContent.scrollHeight + "px";
            configToggleIcon.style.transform = 'rotate(180deg)';
            configToggleText.textContent = 'Fechar';
        }
    });

    configContent.addEventListener('input', (e) => {
        const target = e.target;
        const type = target.dataset.type;
        const key = target.dataset.key;
        let value = target.value;

        if (type === 'cargo') state.config.pontosPorCargo[key] = Number(value);
        else if (type === 'performance') state.config.multiplicadorPorPerformance[key] = Number(value);
        else if (type === 'faixa-ate') state.config.faixasBonificacao[Number(target.dataset.index)].ate = parseCurrency(value);
        else if (type === 'faixa-perc') state.config.faixasBonificacao[Number(target.dataset.index)].perc = parsePercent(value);
        else if (type === 'depto-atingimento') state.config.multiplicadorDepartamento[Number(target.dataset.index)].atingimento = Number(value);
        else if (type === 'depto-multiplicador') state.config.multiplicadorDepartamento[Number(target.dataset.index)].multiplicador = Number(value);
        
        updateSimulation();
    });

    configContent.addEventListener('blur', (e) => {
        const target = e.target;
        const type = target.dataset.type;
        if (type === 'faixa-ate' || type === 'faixa-perc' || type === 'depto-atingimento') {
            renderConfig();
        }
    }, true);


    revenueValue.textContent = formatCurrency(state.revenue);
    departmentGoalValue.textContent = `${state.departmentGoal}%`;
    renderConfig();
    updateSimulation();
});
</script>

</body>
</html>
